{"version":3,"sources":["utils/polyfills/flat.js","utils/config.js","reducers/messages.reducer.js","constants/messages.constatns.js","constants/chat.constants.js","reducers/chat.reducer.js","constants/resources.constants.js","reducers/resources.reducer.js","reducers/geolocation.reducer.js","constants/geolocation.constants.js","reducers/notification.reducer.js","constants/notification.constants.js","reducers/root.reducer.js","actions/messages.actions.js","epics/message.epic.js","actions/chat.actions.js","actions/resources.actions.js","epics/chat.epic.js","utils/transforms/tagsToStations.js","utils/geo/nearLocation.js","epics/geolocation.epic.js","actions/geolocation.actions.js","utils/transforms/entityArray.transforms.js","selectors/resources.selector.js","epics/resources.epics.js","selectors/notification.selector.js","epics/notification.epic.js","actions/notification.actions.js","utils/api.js","utils/inkjs/currentStory.js","utils/inkjs/extractTags.js","utils/notification/notify.js","epics/root.epic.js","createStore.js","assets/simple-forest.svg","components/noMatch.js","components/ChatImage.view.js","components/ChatMessage.view.js","selectors/chat.selector.js","containers/chat.container.js","components/Chat.view.js","components/chatToolbar.component.js","components/ChatButton.view.js","components/toolbar.component.js","selectors/geo.selector.js","selectors/dev.selector.js","containers/dev.container.js","components/dev.view.js","components/messageDisplay.js","selectors/message.selector.js","containers/messages.container.js","utils/geo/checkBounds.js","components/mapIframe.view.js","containers/map.container.js","components/app.js","utils/geo/geolocationEmitter.js","serviceWorker.js","index.js"],"names":["Array","prototype","flat","Object","defineProperty","value","depth","stack","this","item","push","config","trailname","sources","trail","audio","image","initialState","byUuid","messages","state","action","type","uuid","messageType","text","timestamp","hide","messageQueue","jsonFile","undefined","lastRead","loading","chatOptions","index","chat","concat","message","sender","read","tags","map","e","i","options","o","filename","data","json","stations","serviceWorkerActive","addResourceByType","resourceType","resource","resources","active","currentLocation","currentSite","siteType","geoloaction","latitude","longitude","allowed","notification","messagesState","chatState","notificationState","resourceState","geolocation","geolocationState","createRootReducer","history","combineReducers","router","connectRouter","addMessage","Date","now","hideMessage","messagesArray","trigger","combineEpics","action$","pipe","ofType","switchMap","of","delay","MESSAGE_TIME_IN_SECONDS","mS","messageSpec","genUuid","uuidv1","state$","genEpic","addChatMessage","setChatOptions","chooseChatOption","option","loadInkJsonSuccess","loadResourcesSuccess","preloadCacheDataFail","msg","getCurrentStory","extractTags","story","Continue","currentChoices","length","ChooseChoiceIndex","fetchJSON","initStory","a","url","result","console","log","catchError","EMPTY","canContinue","currentTags","getGlobalTags","urls","globalTags","stationTags","getNewId","ret","forEach","t","id","tagDataToStation","chatData","images","error","ChoosePathString","sceneId","isNearLocation","xLatitude","xLongitude","locLatitude","locLongitude","range","geoDistance","lat_1","long_1","lat_2","long_2","degToRad","deltaLat","deltaLong","lat_mean","helper","Math","cos","sqrt","DEG_TO_RAD_FACTOR","PI","deg","station","code","normalizeEntityArray","trailsArray","res","getServiceWorkerStatus","createSelector","status","mergeMap","process","source","normalizedResult","fetch","window","navigator","serviceWorker","controller","postMessage","routes","Promise","all","u","getNotificationPermission","notificationEmitter","format","filterNotifications","location","pathname","notify","logError","filter","params","mockFetchActivities","request","headers","Accept","method","response","s","uuids","includes","activities","activityUrl","resposnes","r","currentStory","Story","tagObject","other","split","trim","imageDataString","imageDataArray","src","alt","extractImageData","join","stationString","extractStationData","Notification","permission","Error","rootEpic","messageEpics","chatEpic","geolocationEpic","resourceEpic","notificationEpic","configureEpicMiddleware","createEpicMiddleware","dependencies","createBrowserHistory","basename","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","_extends","assign","target","arguments","key","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","fill","_ref","svgRef","title","props","width","height","viewBox","ref","ForwardRef","forwardRef","NoMatch","className","ChatImageView","renderedImages","ChatMessageView","messageClasses","senderName","myRef","React","createRef","controls","selectChatMessages","selectChatLastReadIndex","getChatLastReadIndex","getUnreadMessageCount","lastIndex","getChatMessages","getChatOptions","Chat","connect","lastReadIndex","dispatch","markMessagesRead","messagesEndRef","useRef","useEffect","current","children","scrollIntoView","block","behavior","m","idx","ChatToolbar","onSendMessage","chooseFrom","onClick","ChatButton","unreadMessageCount","classes","class","to","ToolbarComponent","path","component","selectCurrentLocation","getCurrentLatitude","getCurrentLongitude","getCurrentPosition","lat","long","getStations","values","Dev","position","JSON","stringify","messageTypeCss","getNewestMessages","sort","b","slice","Messages","onMessageRead","mapBounds","min","max","interactWithIframe","iFrame","checkBounds","contentWindow","setPositionMarker","Map","loaded","addEventListener","App","clearButton","exact","render","dummyFrontPage","isAvailable","watcher","clear","clearWatch","init","watchPosition","geolocationPosition","coords","locationError","isLocalhost","Boolean","hostname","match","defaultSuccess","registerValidSW","swUrl","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","catch","checkValidServiceWorker","contentType","get","ready","unregister","reload","base","rootReducer","preloadedState","persistConfig","storage","blacklist","persistReducer","epicMiddleware","middlewares","routerMiddleware","store","createStore","applyMiddleware","run","persistor","persistStore","configureStore","endsWith","GeolocationEmitter","clearCachesButton","caches","names","name","delete","purge","ReactDOM","document","getElementById","success","publicUrl","URL","href","origin","setSwActive"],"mappings":"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","file":"static/js/main.0effc8f2.chunk.js","sourcesContent":["if (!Array.prototype.flat)\n{\n // eslint-disable-next-line \n    Object.defineProperty(Array.prototype, 'flat',\n    {\n        value: function(depth = 1, stack = [])\n        {\n            for (let item of this)\n            {\n                if (item instanceof Array && depth > 0)\n                {\n                    item.flat(depth - 1, stack);\n                }\n                else {\n                    stack.push(item);\n                }\n            }\n\n            return stack;\n        }\n    });\n}\n","const config = {\n  trailname: 'main',\n  sources : {\n    trail: `/`,\n    audio: `/`,\n    image: `/`\n  }\n}\n\nfunction init(base) {\n  if(!base){\n    base = \"/\"\n  }\n  if(!base.endsWith('/')){\n    base += '/'\n  }\n\n  console.log(\"base: \", base)\n  config.sources = {\n    trail: `${base}assets/trails/`,\n    audio: `${base}assets/audio/`,\n    image: `${base}assets/images/`\n  }\n\n  console.log(config)\n\n  config.trailname = 'trail';\n\n  return config\n}\n\nexport default config\n\nexport {init, config}\n","import {\n  ADD_MESSAGE,\n  HIDE_MESSAGE\n} from '../constants/messages.constatns.js'\n\nexport const initialState = {\n  byUuid: {}\n}\n\nexport default function messages (state = initialState, action) {\n  switch (action.type) {\n    case ADD_MESSAGE:\n      return {\n        byUuid: {\n          ...state.byUuid,\n          [action.uuid]: {\n            messageType: action.messageType,\n            text: action.text,\n            timestamp: action.timestamp,\n            uuid: action.uuid\n          }\n        }\n      }\n    case HIDE_MESSAGE:\n      return {\n        byUuid: {\n          ...state.byUuid,\n          [action.uuid]: {\n            ...state.byUuid[action.uuid],\n            hide: true\n          }\n        }\n      }\n    default:\n      return state\n  }\n}\n","/**\n * Message types (Log, error, points, etc)\n * @typedef {string} MessageType\n */\nexport const MESSAGE_TYPE_ERROR = 'MESSAGE_TYPE_ERROR'\nexport const MESSAGE_TYPE_LOG = 'MESSAGE_TYPE_LOG'\nexport const MESSAGE_TYPE_SUCCESS = 'MESSAGE_TYPE_SUCCESS'\n\n/**\n * Message params\n */\nexport const LAST_MESSAGE_COUNT = 3\nexport const MESSAGE_TIME_IN_SECONDS = 3\n\nexport const ADD_MESSAGE = 'ADD_MESSAGE'\nexport const HIDE_MESSAGE = 'HIDE_MESSAGE'\n\n\n","export const ADD_CHAT_MESSAGE = 'ADD_CHAT_MESSAGE'\nexport const CHOOSE_CHAT_OPTION = 'CHOOSE_CHAT_OPTION'\nexport const SET_CHAT_OPTIONS = 'SET_CHAT_OPTIONS'\nexport const JUMP_TO_SCENE= 'JUMP_TO_SCENE'\nexport const MARK_MESSAGE_READ = 'MARK_MESSAGE_READ'\n\nexport const SENDER_IS_PLAYER = 'SENDER_IS_PLAYER'\nexport const SENDER_IS_SENSI = 'SENDER_IS_SENSI'\n\nexport const LOAD_INK_JSON_START = 'LOAD_INK_JSON_START'\nexport const LOAD_INK_JSON_SUCCESS = 'LOAD_INK_JSON_SUCCESS'\nexport const LOAD_INK_JSON_FAIL = 'LOAD_INK_JSON_FAIL'\n\n","import {\n  ADD_CHAT_MESSAGE,\n  SET_CHAT_OPTIONS,\n  LOAD_INK_JSON_START,\n  LOAD_INK_JSON_SUCCESS,\n  LOAD_INK_JSON_FAIL,\n  MARK_MESSAGE_READ\n} from '../constants/chat.constants.js'\n\nexport const initialState = {\n  messageQueue: [],\n  jsonFile: undefined,\n  lastRead: 0,\n  loading: false,\n  chatOptions: [{text: 'Start', index: -1}]\n}\n\nexport default function chat (state = initialState, action) {\n  switch (action.type) {\n    case ADD_CHAT_MESSAGE:\n      return {\n        ...state,\n        messageQueue: state.messageQueue.concat([{\n          message: action.message,\n          sender: action.sender,\n          read: false,\n          tags: { ...action.tags}\n        }])\n      }\n    case MARK_MESSAGE_READ:\n      return {\n        ...state,\n        lastRead: action.index,\n        messageQueue: state.messageQueue.map((e, i) => {\n          if(i <= action.index){\n            e.read = true;\n          }\n          return e\n        })\n      }\n    case SET_CHAT_OPTIONS:\n      return {\n        ...state,\n        chatOptions: action.options.map(o => { return { ...o } })\n      }\n    case LOAD_INK_JSON_START:\n      return {\n        ...state,\n        loading: true\n      }\n    case LOAD_INK_JSON_SUCCESS:\n      return {\n        ...state,\n        loading: false,\n        jsonFile: {\n          filename: action.filename,\n          data: action.json\n        },   \n      }\n    case LOAD_INK_JSON_FAIL:\n      return {\n        ...state,\n        loading: false,\n        jsonFile: undefined\n      }\n    default:\n      return state\n  }\n}\n","export const LOAD_RESOURCE_START = 'LOAD_RESOURCE_START'\nexport const LOAD_RESOURCE_SUCCESS = 'LOAD_RESOURCE_SUCCESS'\nexport const LOAD_RESOURCE_FAIL = 'LOAD_RESOURCE_FAIL'\n\nexport const RESOURCE_TYPE_STATION = 'RESOURCE_TYPE_STATION'\n\nexport const ADD_RESOURCE = 'ADD_RESOURCE'\n\nexport const PRELOAD_CACHE_DATA = 'PRELOAD_CACHE_DATA'\nexport const PRELOAD_CACHE_DATA_FINISED = 'PRELOAD_CACHE_DATA_FINISED'\nexport const PRELOAD_CACHE_DATA_FAIL = 'PRELOAD_CACHE_DATA_FAIL'\n\nexport const SET_SW_ACTIVE = 'SET_SW_ACTIVE'\n","import {\n  LOAD_RESOURCE_START,\n  LOAD_RESOURCE_SUCCESS,\n  LOAD_RESOURCE_FAIL,\n  ADD_RESOURCE,\n  SET_SW_ACTIVE,\n  RESOURCE_TYPE_STATION\n} from '../constants/resources.constants.js'\n\nexport const initialState = {\n  stations: {},\n  serviceWorkerActive: false,\n  loading: false\n}\n\nfunction resources (state = initialState, action) {\n  switch (action.type) {\n    case LOAD_RESOURCE_START:\n      return {\n        ...state,\n        loading: true\n      }\n    case LOAD_RESOURCE_FAIL:\n      return {\n        ...state,\n        loading: false\n      }\n    case SET_SW_ACTIVE:\n      return {\n        ...state,\n        serviceWorkerActive: action.active\n      }\n    case LOAD_RESOURCE_SUCCESS:\n      return addResourceByType({...state, loading:false}, action)\n    case ADD_RESOURCE:\n      return addResourceByType(state, action)\n    default:\n      return state\n  }\n}\n\nfunction addResourceByType(state, action) {\n  switch(action.resourceType) {\n    case RESOURCE_TYPE_STATION:\n      return {\n        ...state,\n        stations: { ...state.stations, ...action.resource},\n      }\n    default:\n      return state\n  }\n}\n\nexport default resources\n","import {\n  GEOLOCATION_CHANGED,\n  SET_CURRENT_SITE\n} from '../constants/geolocation.constants.js'\n\nexport const initialState = {\n  currentLocation: {},\n  currentSite: {\n    uuid: \"\",\n    siteType: \"none\"\n  }\n}\n\nfunction geoloaction(state = initialState, action) {\n  switch (action.type) {\n    case SET_CURRENT_SITE:\n      return {\n        ...state,\n        currentSite: {\n          uuid: action.uuid,\n          siteType: action.siteType\n        }\n      }\n    case GEOLOCATION_CHANGED:\n      return {\n        ...state,\n        currentLocation: {\n          latitude: action.latitude,\n          longitude: action.longitude\n        }\n      }\n    default:\n      return state\n  }\n}\n\nexport default geoloaction\n","export const GEOLOCATION_CHANGED = 'GEOLOCATION_CHANGED'\n\nexport const GEOLOCATION_ERROR = 'GEOLOCATION_ERROR'\n\nexport const SET_CURRENT_SITE = 'SET_CURRENT_SITE'\n","import {\n  SET_NOTIFICATION_PERMISSION\n} from '../constants/notification.constants.js'\n\nexport const initialState = {\n  allowed: false\n}\n\nexport default function notification (state = initialState, action) {\n  switch (action.type) {\n    case SET_NOTIFICATION_PERMISSION:\n      return {\n        ...state,\n        allowed: action.allowed\n      }\n    default:\n      return state\n  }\n}\n","export const EMIT_NOTIFICATION = 'EMIT_NOTIFICATION'\n\nexport const SET_NOTIFICATION_PERMISSION = 'SET_NOTIFICATION_PERMISSION'\n","import { combineReducers } from 'redux'\nimport { connectRouter } from 'connected-react-router'\nimport messages, { initialState as messagesState } from './messages.reducer.js'\nimport chat, { initialState as chatState } from './chat.reducer.js'\nimport resources, { initialState as resourceState } from './resources.reducer.js'\nimport geolocation, { initialState as geolocationState } from './geolocation.reducer.js'\nimport notification, { initialState as notificationState } from './notification.reducer.js'\n\nexport const initialState = {\n  messages: messagesState,\n  chat: chatState,\n  notification: notificationState,\n  resources: resourceState,\n  geolocation: geolocationState\n}\n\nexport default function createRootReducer (history) {\n  return combineReducers({\n    router: connectRouter(history),\n    messages,\n    chat,\n    notification,\n    resources,\n    geolocation,\n  })\n}\n","import {\n  ADD_MESSAGE,\n  HIDE_MESSAGE\n} from '../constants/messages.constatns.js'\n\n/*\n * @param {MessageType} messageType\n * @param {String} text\n * @param {String} uuid\n * @param {number} timestamp - for injecting a timestamp if needed\n * @return {Object}\n */\nexport function addMessage (messageType, text, uuid, timestamp = null) {\n  if (timestamp === null){\n    timestamp = Date.now()\n  }\n  return {\n    type: ADD_MESSAGE,\n    messageType,\n    text,\n    timestamp,\n    uuid\n  }\n}\n\n/*\n * @param {String} uuid\n * @return {Object}\n */\nexport function hideMessage (uuid) {\n  return {\n    type: HIDE_MESSAGE,\n    uuid\n  }\n}\n","import { map, switchMap, delay } from 'rxjs/operators'\nimport { of } from 'rxjs'\nimport { ofType, combineEpics } from 'redux-observable'\nimport uuidv1 from 'uuid/v1'\n\nimport {\n  LOAD_RESOURCE_FAIL\n} from '../constants/resources.constants.js'\n\nimport {\n  LOAD_INK_JSON_FAIL\n} from '../constants/chat.constants.js'\n\nimport {\n  ADD_MESSAGE,\n  MESSAGE_TYPE_ERROR,\n  //MESSAGE_TYPE_LOG,\n  //MESSAGE_TYPE_SUCCESS,\n  MESSAGE_TIME_IN_SECONDS\n} from '../constants/messages.constatns.js'\n\nimport { addMessage, hideMessage } from '../actions/messages.actions.js'\n\nconst messagesArray = [\n  {\n    trigger: LOAD_RESOURCE_FAIL,\n    type: MESSAGE_TYPE_ERROR,\n    message: 'Fehler: Resourcen konnten nicht gelanden werden'\n  },\n  {\n    trigger: LOAD_INK_JSON_FAIL,\n    type: MESSAGE_TYPE_ERROR,\n    message: 'Fehler: Die Story konnte nicht gelanden werden'\n  },\n]\n\nexport function genEpic (messageSpec, genUuid = uuidv1) {\n  return (action$, state$) => action$.pipe(\n    ofType(messageSpec.trigger),\n    map((action) => {\n      const uuid = genUuid()\n      return addMessage(messageSpec.type, messageSpec.message, uuid)\n    })\n  )\n}\n\nexport function hideMessageEpic (action$) {\n  return action$.pipe(\n    ofType(ADD_MESSAGE),\n    switchMap(action => {\n      return of(hideMessage(action.uuid)).pipe(\n        delay(MESSAGE_TIME_IN_SECONDS * 1000)\n      )\n    })\n  )\n}\n\nexport default combineEpics(hideMessageEpic, ...messagesArray.map(mS => genEpic(mS)))\n","import {\n  ADD_CHAT_MESSAGE,\n  CHOOSE_CHAT_OPTION,\n  SET_CHAT_OPTIONS,\n  JUMP_TO_SCENE,\n  LOAD_INK_JSON_START,\n  LOAD_INK_JSON_SUCCESS,\n  LOAD_INK_JSON_FAIL,\n  MARK_MESSAGE_READ\n} from '../constants/chat.constants.js'\n\n/**\n * @param {string} sceneId - scene identification\n */\nexport function jumpToScene (sceneId){\n  return {\n    type: JUMP_TO_SCENE,\n    sceneId\n  }\n}\n\n/**\n * @param {string} message - message to display\n * @param {string} sender - sender identification\n * @param {string} audio - audio src\n */\nexport function addChatMessage (message, sender, tags = {}){\n  return {\n    type: ADD_CHAT_MESSAGE,\n    message,\n    sender,\n    tags\n  }\n}\n\n/**\n * @param {Object[]} options \n */\nexport function setChatOptions(options){\n  return {\n    type: SET_CHAT_OPTIONS,\n    options\n  }\n}\n\n/**\n * @param {number} option - index of the choose option\n */\nexport function chooseChatOption(option){\n  return {\n    type: CHOOSE_CHAT_OPTION,\n    option\n  }\n}\n\n/**\n * @param {number} index - index of the message newest read message\n */\nexport function markMessageRead(index){\n  return {\n    type: MARK_MESSAGE_READ,\n    index\n  }\n}\n\n/**\n * @param {string} filename  \n */\nexport function loadInkJsonStart(filename){\n  return {\n    type: LOAD_INK_JSON_START,\n    filename\n  }\n}\n\n/**\n * @param {string} filename  \n * @param {Object} json\n */\nexport function loadInkJsonSuccess(filename, json){\n  return {\n    type: LOAD_INK_JSON_SUCCESS,\n    filename,\n    json\n  }\n}\n\n/**\n * @param {string} filename  \n */\nexport function loadInkJsonFail(filename){\n  return {\n    type: LOAD_INK_JSON_FAIL,\n    filename\n  }\n}\n\n","import {\n  LOAD_RESOURCE_START,\n  LOAD_RESOURCE_SUCCESS,\n  LOAD_RESOURCE_FAIL,\n  PRELOAD_CACHE_DATA,\n  PRELOAD_CACHE_DATA_FINISED,\n  PRELOAD_CACHE_DATA_FAIL,\n  SET_SW_ACTIVE,\n  ADD_RESOURCE\n} from '../constants/resources.constants.js'\n\n/**\n * @param {string} source - resource name\n */\nexport function loadResource (source) {\n  return {\n    type: LOAD_RESOURCE_START,\n    source\n  }\n}\n\n/**\n * @param {Object} resources - loaded Resources\n * @param {String} resourceType - Type of resources\n */\nexport function loadResourcesSuccess (resource, resourceType = '') {\n  return {\n    type: LOAD_RESOURCE_SUCCESS,\n    resource,\n    resourceType\n  }\n}\n\n/**\n */\nexport function loadResourcesFail () {\n  return {\n    type: LOAD_RESOURCE_FAIL,\n  }\n}\n\n/**\n * @param {Object} resource - Resources to Add\n * @param {String} resourceType - Type of resources\n */\nexport function addResource(resource, resourceType) {\n  return {\n    type: ADD_RESOURCE,\n    resource,\n    resourceType\n  }\n}\n\n/**\n * @param {string[]} urls \n */\nexport function preloadCacheData(urls){\n  return {\n    type: PRELOAD_CACHE_DATA,\n    urls\n  }\n}\n\n/**\n * @param {string[]} urls \n */\nexport function preloadCacheDataFinished(urls){\n  return {\n    type: PRELOAD_CACHE_DATA_FINISED,\n    urls\n  }\n}\n/**\n * @param {string[]} urls \n */\nexport function preloadCacheDataFail(msg){\n  return {\n    type: PRELOAD_CACHE_DATA_FAIL,\n    msg\n  }\n}\n\n/**\n * @param {bool} active - default true \n */\nexport function setSwActive(active = true){\n  return {\n    type: SET_SW_ACTIVE,\n    active\n  }\n}\n","import { ofType, combineEpics } from 'redux-observable'\nimport { of, EMPTY } from 'rxjs'\nimport { switchMap, catchError, delay } from 'rxjs/operators'\n\nimport { tagDataToStation } from '../utils/transforms/tagsToStations.js'\n\nimport {\n  CHOOSE_CHAT_OPTION,\n  LOAD_INK_JSON_START,\n  LOAD_INK_JSON_SUCCESS,\n  ADD_CHAT_MESSAGE,\n  SENDER_IS_PLAYER,\n  SENDER_IS_SENSI,\n  JUMP_TO_SCENE\n} from '../constants/chat.constants.js'\n\nimport {\n  addChatMessage,\n  loadInkJsonSuccess,\n  loadInkJsonFail,\n  setChatOptions,\n  chooseChatOption,\n} from '../actions/chat.actions.js'\n\nimport {\n  addResource,\n  preloadCacheData\n} from '../actions/resources.actions.js'\n\nimport {\n  RESOURCE_TYPE_STATION\n} from '../constants/resources.constants.js'\n/**\n */\nexport function sendChatMessage (action$, state$, { getCurrentStory, extractTags }) {\n  return action$.pipe(\n    ofType(CHOOSE_CHAT_OPTION),\n    switchMap(action => {\n      \n      const story = getCurrentStory()\n\n      if(action.option < 0){\n        const message = story.Continue()\n        //const tags = extractTags(story.currentTags)\n        return of(addChatMessage(message, SENDER_IS_SENSI, {}))\n      }\n\n      if (story.currentChoices.length > 0) {\n        story.ChooseChoiceIndex(action.option)\n      }\n\n      return of(addChatMessage(story.Continue(), SENDER_IS_PLAYER))\n    })\n  )\n}\n\nexport function getJumpToScene(action$, state$, { getCurrentStory }) {\n  return action$.pipe(\n    ofType(JUMP_TO_SCENE),\n    switchMap(action => {\n      const story = getCurrentStory()\n      if(!story){\n        return EMPTY\n      }\n      story.ChoosePathString(action.sceneId)\n\n      return [chooseChatOption(-1)]\n\n    })\n  )\n}\n\n\nexport function getNextOptionOrContinue (action$, state$, { getCurrentStory, extractTags }) {\n  return action$.pipe(\n    ofType(ADD_CHAT_MESSAGE),\n    switchMap(action => {\n      const story = getCurrentStory()\n      if(!story){\n        return EMPTY\n      }\n\n      if (story.canContinue) {\n\n        const message = story.Continue()\n        const tags = extractTags(story.currentTags)\n        return of(addChatMessage(message, SENDER_IS_SENSI, tags)).pipe(\n          delay(1000)\n        )\n      } else {\n        if (story.currentChoices.length > 0) {\n          const options = story.currentChoices.map(o => {\n            return {\n              text: o.text,\n              index: o.index\n            }\n          })\n          return of(setChatOptions(options))\n        }\n        return of(setChatOptions([]))\n      }\n    })\n  )\n}\n\nexport function loadInkJsonEpic (action$, state$, { fetchJSON, initStory}) {\n  return action$.pipe(\n    ofType(LOAD_INK_JSON_START),\n    switchMap(async action => {\n      if(\n        state$.value.chat.jsonFile && \n        state$.value.chat.jsonFile.filename === action.filename\n      ){\n        initStory(state$.value.chat.jsonFile.data)\n        return loadInkJsonSuccess(action.filename, state$.value.chat.jsonFile.data) \n      }\n      const url = action.filename\n      const result = await fetchJSON(url)\n      initStory(result)\n      console.log(\"story loaded: \", action.filename)\n\n      return loadInkJsonSuccess(action.filename, result) \n    }),\n    catchError((e) => {\n      return [\n        loadInkJsonFail()\n      ]\n    })\n  )\n}\n\nexport function startStoryEpic (action$, state$, { getCurrentStory, getGlobalTags }) {\n  return action$.pipe(\n    ofType(LOAD_INK_JSON_SUCCESS),\n    switchMap(action => {\n      const story = getCurrentStory()\n      console.log(story)\n      const globalTags = getGlobalTags(story.globalTags)\n      console.log(\"globalTags:\", globalTags)\n      if(globalTags) {\n\n        const stations = tagDataToStation(globalTags.stations)\n        const chatData = [...globalTags.audio, ...globalTags.images]\n\n        return [preloadCacheData(chatData),addResource(stations, RESOURCE_TYPE_STATION),chooseChatOption(-1)]\n      } else {\n        console.error('could not load global Tags')\n        return [chooseChatOption(-1)]\n      }\n    })\n  )\n}\n\n\nexport default combineEpics(\n  sendChatMessage,\n  loadInkJsonEpic,\n  getNextOptionOrContinue,\n  startStoryEpic,\n  getJumpToScene\n)\n","import uuidv1 from 'uuid/v1'\n\nexport function tagDataToStation(stationTags, getNewId = uuidv1) {\n  const ret = {}\n  stationTags.forEach(t => {\n    const id = getNewId()\n    ret[id] = {\n      ...t,\n      id: getNewId,\n    }\n  })\n  return ret\n}\n","/**\n * @param {double} xLatitude\n * @param {double} xLongitude\n * @param {double} locLatitude\n * @param {double} locLongitude\n * @param {number} range\n */\n\nexport default function isNearLocation(xLatitude, xLongitude, locLatitude, locLongitude, range = 10){\n  return geoDistance(xLatitude, xLongitude, locLatitude, locLongitude) < range;\n}\n\nconst EARTH_RAD_R = 6371009 //Earth Radius in meter\n\n/**\n * @param {double} lat_1\n * @param {double} long_1\n * @param {double} lat_2\n * @param {double} long_2\n * return {double}\n */\nexport function geoDistance(lat_1, long_1, lat_2, long_2)\n{\n  lat_1 = degToRad(lat_1)\n  long_1 = degToRad(long_1)\n  lat_2 = degToRad(lat_2)\n  long_2 = degToRad(long_2)\n  const deltaLat = lat_2 - lat_1\n  const deltaLong = long_2 - long_1\n\n  const lat_mean = (lat_1 + lat_2)/2\n  \n  let helper = Math.cos(lat_mean)*deltaLong\n  helper = helper*helper\n\n  return EARTH_RAD_R * Math.sqrt(\n    (deltaLat * deltaLat) + helper\n  )\n}\n\nconst DEG_TO_RAD_FACTOR = Math.PI / 180\n\n/**\n * @param {double} deg - angle in degree\n * @return {double} - angle in radians\n */\nfunction degToRad(deg){\n  return DEG_TO_RAD_FACTOR*deg\n}\n","import { ofType, combineEpics } from 'redux-observable'\nimport { of, EMPTY } from 'rxjs'\nimport { switchMap } from 'rxjs/operators'\n\nimport isNearLocation from '../utils/geo/nearLocation.js'\n\nimport uuidv1 from 'uuid/v1'\n\nimport {\n  GEOLOCATION_CHANGED,\n  GEOLOCATION_ERROR\n} from '../constants/geolocation.constants.js'\n\nimport {\n  setCurrentSite\n} from '../actions/geolocation.actions.js'\n\nimport {\n  jumpToScene,\n} from '../actions/chat.actions.js'\n\nimport {\n  MESSAGE_TYPE_ERROR,\n} from '../constants/messages.constatns.js'\n\nimport { addMessage } from '../actions/messages.actions.js'\n/**\n */\nexport function changeLocationEpic(action$, state$ ) {\n  return action$.pipe(\n    ofType(GEOLOCATION_CHANGED),\n    switchMap(action => {\n\n      const stations = state$.value.resources.stations\n      const currentSite = state$.value.geolocation.currentSite\n      for(let id in stations){\n        if(id === currentSite.uuid){\n          continue\n        }\n        if(isNearLocation(\n          action.latitude,\n          action.longitude,\n          stations[id].latitude,\n          stations[id].longitude\n        )) {\n          return [\n            jumpToScene(stations[id].station),\n            setCurrentSite(id, \"stations\")\n          ]\n        }\n      }\n      return EMPTY\n    })\n  )\n}\n\n/**\n */\nexport function locationErrorEpic(action$, state$ ) {\n  return action$.pipe(\n    ofType(GEOLOCATION_ERROR),\n    switchMap(action => {\n      console.log(action)\n      console.log(\"GEOLOCATION_ERROR\")\n      const uuid = uuidv1()\n      const message = `Geolocation Error. Code: ${action.error.code} msg: ${action.error.message}`\n      return of(addMessage(MESSAGE_TYPE_ERROR, message, uuid))\n    })\n  )\n}\n\nexport default combineEpics(\n  changeLocationEpic,\n  locationErrorEpic\n)\n","import {\n  GEOLOCATION_CHANGED,\n  GEOLOCATION_ERROR,\n  SET_CURRENT_SITE\n} from '../constants/geolocation.constants.js'\n\n/**\n * @param {double} latitude \n * @param {double} longitude \n * @return {Object}\n */\nexport function changeLocation(latitude, longitude){\n  return {\n    type: GEOLOCATION_CHANGED,\n    latitude,\n    longitude\n  }\n}\n\n/**\n * @param {String} err\n * @return {Object}\n */\nexport function locationError(error){\n  //console.error(error)\n  return {\n    type: GEOLOCATION_ERROR,\n    error\n  }\n}\n\n/**\n * @param {String} uuid\n * @param {String} siteType\n * @return {Object}\n */\nexport function setCurrentSite(uuid, siteType){\n  return {\n    type: SET_CURRENT_SITE,\n    uuid,\n    siteType\n  }\n}\n","export function normalizeEntityArray (trailsArray) {\n  const res = {}\n  for (const trail of trailsArray) {\n    res[trail.uuid] = trail\n  }\n  return res\n}\n\nexport function getSlugsEntityArray (array) {\n  const res = {}\n  for (const entity of array) {\n    res[entity.slug] = entity.uuid\n  }\n  return res\n}\n","import { createSelector } from 'reselect'\n\nexport function selectSwStatus (state) {\n  return state.resources.serviceWorkerActive\n}\n\nexport const getServiceWorkerStatus = createSelector(\n  [selectSwStatus],\n  (status) => status\n)\n \n  /*\nfunction sortByTimestamp(a, b) {\n  a.timestamp - b.timestamp;\n  //if (a is less than b by some ordering criterion) {\n  if(a,timestamp)\n    return -1;\n  }\n  if (a is greater than b by the ordering criterion) {\n    return 1;\n  }\n  // a must be equal to b\n  return 0;\n}*/\n","import { mergeMap, catchError } from 'rxjs/operators'\nimport { ofType, combineEpics } from 'redux-observable'\nimport { normalizeEntityArray } from '../utils/transforms/entityArray.transforms.js'\n\nimport {\n  LOAD_RESOURCE_START,\n  PRELOAD_CACHE_DATA\n} from '../constants/resources.constants.js'\n\nimport {\n  loadResourcesSuccess,\n  loadResourcesFail,\n  preloadCacheDataFinished,\n  preloadCacheDataFail,\n} from '../actions/resources.actions.js'\n\nimport {\n  getServiceWorkerStatus\n} from '../selectors/resources.selector.js'\n\nexport function loadResourcesEpic (action$, state$, { fetchJSON }) {\n  return action$.pipe(\n    ofType(LOAD_RESOURCE_START),\n    mergeMap(async action => {\n      const url = process.env.PUBLIC_URL + '/json/'+action.source\n      const result = await fetchJSON(url)\n      const normalizedResult = normalizeEntityArray([result])\n      return loadResourcesSuccess(normalizedResult)\n    }),\n    catchError((e) => {\n      return [\n        loadResourcesFail()\n      ]\n    })\n  )\n}\n\nexport function preloadCacheData (action$, state$, { fetch }) {\n  return action$.pipe(\n    ofType(PRELOAD_CACHE_DATA),\n    mergeMap(async action => {\n      const serviceWorkerActive = getServiceWorkerStatus(state$.value)\n      if(serviceWorkerActive){\n        window.navigator.serviceWorker.controller.postMessage({\n          type: 'NATURE40_ADD_ROUTE',\n          routes: action.urls\n        })\n        await Promise.all(action.urls.map(u => {\n          console.log(\"fetching \", u)\n          return fetch(u)\n        }))\n        \n        return preloadCacheDataFinished(action.urls)\n      }\n      return preloadCacheDataFail(\"No Service Worker active\")\n    }),\n    catchError((e) => {\n      return [\n        preloadCacheDataFail(e)\n      ]\n    })\n  )\n}\n\n\nexport default combineEpics(\n  loadResourcesEpic,\n  preloadCacheData \n)\n","import { createSelector } from 'reselect'\n\nexport function selectNotificationPermission (state) {\n  return state.notification.allowed\n}\n\nexport const getNotificationPermission = createSelector(\n  [selectNotificationPermission],\n  (allowed) => allowed\n)\n \n","import { switchMap, filter, catchError, map } from 'rxjs/operators'\nimport { ofType, combineEpics } from 'redux-observable'\n\nimport {\n  EMIT_NOTIFICATION\n} from '../constants/notification.constants.js'\n\nimport {\n  ADD_CHAT_MESSAGE,\n  SENDER_IS_PLAYER\n} from '../constants/chat.constants.js'\n\nimport {\n  emitNotification\n} from '../actions/notification.actions.js'\n\nimport {\n  getNotificationPermission,\n} from '../selectors/notification.selector.js'\n\n\nexport function emitNotificationEpic (action$, state$, { notify, logError }) {\n  return action$.pipe(\n    ofType(EMIT_NOTIFICATION),\n    filter(() => {\n      const allowed = getNotificationPermission(state$.value)\n\n      return allowed\n\n    }),\n    switchMap(action => {\n      notify(action.message)\n      return []\n    }),\n    catchError((e) => {\n      logError('[ERROR]: ', e)\n      return []\n    })\n  )\n}\n\nconst notificationEmitter = [\n  {\n    trigger: ADD_CHAT_MESSAGE,\n    format: (action) => `${action.sender}: ${action.message}`,\n    filterNotifications: (action, state) => {\n      return state.router.location.pathname !== '/chat' && action.sender !== SENDER_IS_PLAYER\n    }\n  }\n]\nfunction genEpic ( {trigger, format, filterNotifications} ) {\n  return (action$, state$) => action$.pipe(\n    ofType(trigger),\n    filter((action) => filterNotifications(action, state$.value)),\n    map((action) => {\n      return emitNotification(format(action))\n    })\n  ) \n}\n\n\nexport default combineEpics(\n  emitNotificationEpic,\n  ...notificationEmitter.map(genEpic)\n)\n","import {\n  EMIT_NOTIFICATION,\n  SET_NOTIFICATION_PERMISSION\n} from '../constants/notification.constants.js'\n\n/**\n * @param {string} msg - Notification Message\n * @return emitNotificationAction\n */\nexport function emitNotification(msg) {\n  return {\n    type: EMIT_NOTIFICATION,\n    message: msg\n  }\n}\n\n/**\n * @param {boolean} allowed - permission to send notifications\n * @return setNotificationPermissionAction\n */\nexport function setNotificationPermission(allowed) {\n  return {\n    type: SET_NOTIFICATION_PERMISSION,\n    allowed\n  }\n}\n","/**\n * @throws JSON Parse\n * @param {string} url - url to fetch json data from\n * @return {Object} - JS Object from JSON files\n */\nexport async function fetchJSON (url, params = {}) {\n  /** MOCK LOAD ACTIVITES */\n  if (url === process.env.PUBLIC_URL + '/json/activities.json') {\n    return mockFetchActivities(params)\n  }\n  const request = {\n    headers: {\n      Accept: 'application/json'\n    },\n    method: 'GET'\n  }\n  const response = await window.fetch(url, request)\n  const data = await response.json()\n  /** MOCK only loading trails stations. Needs some kind of api */\n  if ('uuids' in params) {\n    return data.filter(s => params.uuids.includes(s.uuid))\n  }\n  return data\n}\n\nexport async function getResources (urls, params = {}) {\n  const request = {\n    method: 'GET'\n  }\n  const requests = urls.map((url) => window.fetch(url, {...request}))\n  await Promise.all(requests)\n\n  return true;\n}\n\nasync function mockFetchActivities ({ uuids }) {\n  const request = {\n    headers: {\n      Accept: 'application/json'\n    },\n    method: 'GET'\n  }\n  const activities = [\n    process.env.PUBLIC_URL + '/json/textActivity.json',\n    process.env.PUBLIC_URL + '/json/imageActivity.json',\n    process.env.PUBLIC_URL + '/json/multiChoiceActivity.json'\n  ]\n  const resposnes = await Promise.all(\n    activities.map(activityUrl => window.fetch(activityUrl, request))\n  )\n  const data = await Promise.all(\n    resposnes.map(r => r.json())\n  )\n\n  return data.flat().filter(s => uuids.includes(s.uuid))\n}\n","// import { Story } from 'inkjs'\nimport { Story } from '../../../node_modules/inkjs/dist/ink.js'\n\n\nlet currentStory\n\nexport function initStory (json) {\n  currentStory = new Story(json)\n  return currentStory\n}\n\nexport function getCurrentStory () {\n  return currentStory\n}\n","//https://github.com/inkle/ink/blob/master/Documentation/RunningYourInk.md#marking-up-your-ink-content-with-tags\nimport config from '../config.js'\n\n/**\n * @param {String[]} tags\n * @return {Object}\n */\nexport function extractTags (tags) {\n  const tagObject = {\n  }\n\n  const other = []\n\n  tags.forEach((e) => {\n    const split = e.split(':')\n    switch(split[0]) {\n      case 'audio': \n        tagObject.audio = config.sources.audio+split[1].trim()\n        break;\n      case 'image':\n        if(! ('images' in tagObject)){\n          tagObject.images = []\n        }\n        tagObject.images.push(extractImageData(split[1].trim()))\n        break;\n      default:\n        other.push(split.join(':'))\n    }\n  })\n  if(other.length > 0){\n    tagObject.other = other\n  }\n  return tagObject\n}\n\n/**\n * @param {string} imageDataString\n * @return {Object}\n */\nexport function extractImageData(imageDataString) {\n  const imageDataArray = imageDataString.split(' ')\n  return {\n    src: config.sources.image + imageDataArray[0],\n    alt: imageDataArray.length > 1 && imageDataArray[1] !== '' ? imageDataArray[1] : 'Bild'\n  }\n}\n\n/**\n * @param {String[]} globalTags\n * @return {Object}\n*/\nexport function getGlobalTags (globalTags) {\n  const tagObject = {\n  }\n\n  const other = []\n  const stations = []\n\n  globalTags.forEach((e) => {\n    const split = e.split(':')\n    console.log(split)\n    switch(split[0]) {\n      case 'station': \n        stations.push(extractStationData(split[1]))\n        break;\n      case 'audio': \n        if(! ('audio' in tagObject)){\n          tagObject.audio= []\n        }\n        tagObject.audio.push(config.sources.audio+split[1].trim())\n        break;\n      case 'image':\n        if(! ('images' in tagObject)){\n          tagObject.images = []\n        }\n        tagObject.images.push(config.sources.image+split[1].trim())\n        break;\n      default:\n        other.push(split.join(':'))\n    }\n  })\n\n  if(stations.length > 0) tagObject.stations = [...stations]\n  if(other.length > 0) tagObject.other = [...other]\n\n  return tagObject\n}\n\nfunction extractStationData(stationString) {\n  console.log(\"extractStationData\")\n  console.log(stationString)\n  const split = stationString.split(\" \")\n  console.log(split)\n\n  return {\n    station: split[0],\n    latitude: split[1],\n    longitude: split[2]\n  }\n  \n\n}\n","export default function notify(message) {\n  if(!( 'Notification' in window)){\n    console.error('This browser does not support desktop notification')\n  }\n\n  else if (window.Notification.permission === \"granted\") {\n    console.log('notify')\n    const notification = new Notification(message)\n    console.log(notification)\n  }\n\n  else if (window.Notification.permission !== \"denied\"){\n    console.error('PERM NOT SET')\n    throw new Error('Notification Permission not set')\n  }\n}\n","import { combineEpics, createEpicMiddleware } from 'redux-observable'\nimport messageEpics from './message.epic.js'\nimport chatEpic from './chat.epic.js'\nimport geolocationEpic from './geolocation.epic.js'\nimport resourceEpic from './resources.epics.js'\nimport notificationEpic from './notification.epic.js'\n\n/* DEPENDENCIES */\nimport { fetchJSON } from '../utils/api.js'\nimport { getCurrentStory, initStory } from '../utils/inkjs/currentStory.js'\nimport { extractTags, getGlobalTags } from '../utils/inkjs/extractTags.js'\nimport notify from '../utils/notification/notify.js'\n\nconst rootEpic = combineEpics(\n  messageEpics,\n  chatEpic,\n  geolocationEpic,\n  resourceEpic,\n  notificationEpic\n)\n\nexport const configureEpicMiddleware = () => createEpicMiddleware({\n  dependencies: {\n    fetchJSON,\n    fetch: window.fetch,\n    getCurrentStory,\n    initStory,\n    extractTags,\n    getGlobalTags,\n    logError: (e) => console.error(e),\n    notify\n  }\n})\n\nexport default rootEpic\n","import { createBrowserHistory } from 'history'\nimport { applyMiddleware, compose, createStore } from 'redux'\nimport { routerMiddleware } from 'connected-react-router'\n\nimport { persistStore, persistReducer } from 'redux-persist'\nimport storage from 'redux-persist/lib/storage' // defaults to localStorage for web\n\nimport createRootReducer, { initialState } from './reducers/root.reducer.js'\nimport rootEpic, { configureEpicMiddleware } from './epics/root.epic.js'\n\nexport const history = createBrowserHistory({\n  basename: process.env.PUBLIC_URL\n})\n\nconst composeEnhancers = (typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose\n\nexport default function configureStore (preloadedState = initialState) {\n\n  let rootReducer, persistor\n\n  if (process.env && process.env.NODE_ENV === 'production') {\n    const persistConfig = {\n      key: 'root',\n      storage,\n      blacklist: ['router']\n    }\n\n    rootReducer = persistReducer(persistConfig, createRootReducer(history))\n  } else {\n    rootReducer = createRootReducer(history)\n  }\n\n  const epicMiddleware = configureEpicMiddleware()\n\n  const middlewares = [\n    epicMiddleware,\n    routerMiddleware(history)\n  ]\n\n  const store = createStore(\n    rootReducer,\n    preloadedState,\n    composeEnhancers(\n      applyMiddleware(...middlewares)\n    )\n  )\n\n  epicMiddleware.run(rootEpic)\n\n  if (process.env && process.env.NODE_ENV === 'production') {\n    persistor = persistStore(store)\n  }\n\n  return { store, persistor }\n}\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M51.829 27.231L39.016 47.485l3.79 1.896-7.56 11.117 6.371.455-8.821 15.68 5.257 3.346-14.276 20.492 7.097 1.978-12.376 18.977 5.14 1.87-9.575 15.046 5.983.5-17.234 20.27 10.016 2.75 31.366 2.43-1.009 11.677h17.192l-1.005-11.629 31.041-3.654 11.164.688-17.972-22.54 5.894-.492-9.574-15.046 5.156-1.876-13.468-21.162 7.862-.232L65.51 79.98l5.224-3.326-7.827-12.925 5.725-2.634-9.45-12.562 4.894-1.253-6.933-7.974 1.55-2.204zm167.607.099l-12.54 19.823 3.71 1.856-7.398 10.88 6.234.444-8.633 15.345 5.145 3.274-13.97 20.055 6.945 1.936-12.114 18.573 5.03 1.829-9.37 14.726 5.856.488-16.866 19.84 9.803 2.69 30.697 2.377-.989 11.428h16.825l-.984-11.38 30.38-3.578 10.925.674-17.588-22.058 5.769-.48-9.371-14.727 5.047-1.835-13.18-20.711 7.693-.227-13.668-19.62 5.113-3.255-7.66-12.65 5.604-2.576-9.25-12.294 4.79-1.226-6.785-7.804 1.517-2.157zm-20.19 11.522l-1.963 2.825.57.812-2.26 2.6 1.7.435-3.43 4.558 2 .92-2.819 4.654 1.884 1.199-.85 1.218 1.32 2.087-2.476 1.239 5.596 8.23-4.513.322 3.63 6.454 7.841-13.94-6.614-.472 5.607-8.245-2.196-3.906 2.21-.158-2.568-3.775 1.365-.683zm-99.699 3.444l-1.964 2.825.571.812-2.261 2.6 1.7.436-3.43 4.557 2 .92-2.818 4.655 1.883 1.2-.651.934 5.902 9.328-1.667.834 2.15 3.16 1.46-2.41-2.18-1.002 3.173-4.217-1.893-.485 3.165-3.64-.492-.7.496-.712-.76-1.09 1.905-1.214-3.264-5.8 2.21-.158-2.567-3.776 1.365-.682zm84.933 3.68l-4.583 6.592 1.035 1.472-4.63 5.325 3.269.836-6.312 8.389 3.824 1.759-1.36 2.246-.414.683-3.452 5.702 3.488 2.22-6.969 10.004-2.357 3.384 2.768.082-.247-.355.778-.6-.04.131.61-.471-.004-.007-.18.05.136-.106 1.211 1.424.217.006-2.065 3.245-.009.015-6.919 10.872 3.444 1.252-6.394 10.048 3.936.328-12 15.05 7.453-.458 20.026 2.358 9.461-14.868-5.063-1.842 11.976-18.361-7.05-1.966 9.501-13.637-3.886-5.579 3.51-2.234-5.89-10.47 4.253-.303-5.048-7.424 2.532-1.266-2.013-3.183-.219-.139.064-.105zm-33.151 1.757l-1.964 2.825.57.812-2.26 2.6 1.7.435-3.43 4.558 2 .92-2.819 4.655 1.884 1.198-4.465 6.41.284.503 2.146.063-1.12 1.762.078.138-.28.178-1.366 2.148 5.526 7.932 2.77-4.575-2.736-1.259 4.054-5.388-2.372-.607 3.888-4.473-.633-.901 1.892-2.722 1.757-2.527-2.079-3.695 2.21-.157-2.567-3.776 1.365-.682zm-70.36 3.065l-1.683 2.42.521.742L77.8 56.27l1.532.392-3.12 4.147 1.804.83-2.561 4.229 1.711 1.09-4.318 6.197 2.503.074-1.954 3.07.69 1.139-2.377 1.513-.828 1.3 1.666.607-1.635 2.57 7.274 10.442.25.03 2.183-3.134-1.55.095 4.915-6.162-1.688-1.074 3.433-5.67-2.736-1.258 4.054-5.388-2.373-.607 1.538-1.77-1.376-1.975 1.733-1.103-2.982-5.3 1.991-.143-2.3-3.384 1.238-.62zm38.897.953l-1.964 2.825.571.813-2.261 2.6 1.7.435-3.43 4.558 2 .92-2.502 4.131.869 1.278.698.443-.2.288.546.804.474.697-2.173.155-.171.245 2.628 4.672-1.772 1.129 4.654 6.68 5.833-8.372-2.285-1.454 2.113-3.489-.944-1.354 1.704-1.085-2.176-1 1.079-1.435-1.966-3.493 2.21-.158-2.566-3.775 1.364-.683zm13.62.57l-2.765 3.975.713 1.013-2.985 3.433 2.18.558-3.812 5.066-.498.662 1.175.54 1.381.637-.53.876.006.013-.023.015-1.174 1.938-1.833 3.027 2.374 1.511-6.185 8.879 3.526.104-4.445 6.985-.683 1.072-1.027 1.615 2.329.847-4.266 6.704 2.72.226-5.11 6.41-2.68 3.36.193.303 4.01-.247 14.3 1.684-.452 5.22h7.184l-.454-5.253 2.308-.178 3.83-6.017-2.33-.848 5.702-8.96-3.673-.107 3.5-5.023.476-.685-3.93-6.026 3.194-.89-6.391-9.175 2.395-1.524-4.066-7.228 2.834-.202-3.325-4.89 1.721-.861zm-25.32 6.952l-.187.27.054.095-.217.139-1.614 2.32.571.813-2.261 2.6 1.7.435-3.43 4.558 2 .92-2.804 4.63.042.061 1.827 1.163-2.366 3.396 1.668 2.965-1.588 1.01-.465.731 6.526 9.369-3.265.91 5.511 8.45-2.34.85 3.212 5.047-.252-2.913 3.225-.25 2.745-3.442-2.362-.196 4.627-7.271-2.329-.848 2.528-3.972-3.877-5.945 2.514-.7-5.01-7.191 1.906-1.213-2.371-4.214-.893-1.586 2.102-.15.108-.009-2.567-3.775 1.365-.682zm62.179 1.504l-1.964 2.825.57.812-2.26 2.6 1.699.436-3.429 4.558 2 .92-1.812 2.991 2.39 3.515-2.07.147-.59.846 3.123 5.55-1.515.965.505.795-.974.08 1.356 1.948 5.642-8.098-3.4-2.164 4.202-6.938-.45-.797.975-.07.38-.626-4.004-1.84 2.702-3.592zm-77.644.57l-2.764 3.975.713 1.013-2.985 3.433 2.18.558-4.31 5.728 2.556 1.176-3.554 5.87 2.374 1.511-4.197 6.025-1.988 2.854 3.526.104-2.987 4.694 2.833 4.067-5.524.162-.477.749 2.33.847-1.721 2.704 9.944 15.624.943.111-.451 5.22h7.184l-.455-5.252 14.408-1.115 4.097-1.125-5.4-6.353-.959.06.488-.612-.43-.506-1.548-1.82 2.78-.232-4.266-6.704 2.318-.843-5.605-8.594 3.194-.89-5.545-7.96-.236-.339-.934-1.34 1.006.03 1.713-1.09-.515-.916-.895-1.591-2.656-4.72 2.835-.203-3.326-4.89 1.722-.861zm64.853 2.34l-2.764 3.975.713 1.014-2.985 3.433 2.179.557-4.31 5.728 2.558 1.176-3.555 5.87 2.374 1.511-3.313 4.755-1.014 1.456-1.857 2.668 3.526.104-6.155 9.672 2.328.847-4.265 6.704.045.004.018.001 2.656.221-8.053 10.1 4.467-.274 14.3 1.683-.391 4.517 6-7.524-3.58-.298 6.756-10.616-3.444-1.252 7.46-11.722-.64-.982 1.537-.428.182-.286-5.395-.159 2.757-3.958.683-.98-2.962-4.253.852-.542.648-.413.694-.442.201-.128-4.066-7.227 2.834-.203-3.324-4.89 1.72-.86zm40.177 12.887l1.655 2.943-3.377 2.15 2.558 3.673 3.974-5.704zm-97.014.66l-1.126.08.994 1.768.932-1.338-.406-.259-.07.115-.19-.28zm17.779 8.679l-.848.236 2.243 3.44 2.205-3.463-3.673-.109zm28.772.126l-2.127.593 2.341 3.589 1.953-2.803zm-68.234 9.046l1.212 1.741 1.066-1.674zm100.35 43.147l-.495 5.713 4.569-5.373z\",\n  fill: \"#173d10\"\n});\n\nvar SvgSimpleForest = function SvgSimpleForest(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 1024,\n    height: 768,\n    viewBox: \"0 0 270.933 203.2\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgSimpleForest, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/simple-forest.4a77c0d8.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react'\nimport { ReactComponent as ForestSvg } from '../assets/simple-forest.svg'\n\nimport '../styles/noMatch.css'\n\nconst NoMatch = () => {\n  return (\n    <div className='page--404'>\n      <h1>Das war die Falsche Abzweigung</h1>\n      <ForestSvg />\n      <p>Du scheinst dich ein wenig im Wald verrirrt zu haben. Diese Seite exisitiert leider nicht.</p>\n      <p>Geh doch einfach nochmal eine Seite zurck und versuchs mit einer anderen Abzweigung.</p>\n    </div>\n  )\n}\n\nexport default NoMatch\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport '../styles/chat_images.scss'\n\nexport default function ChatImageView ({ images = [] }) {\n\n  const renderedImages = images.map((image, i) => {\n    return (\n      <img src={image.src} key={i} alt={image.alt} />\n    )\n  })\n\n  return (\n    <div className='chat__images'>\n      {renderedImages}\n    </div>\n  )\n}\n\nChatImageView.propTypes = {\n  images: PropTypes.array\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport {SENDER_IS_PLAYER} from '../constants/chat.constants.js'\n\nimport ChatImageView from './ChatImage.view.js'\n\nimport '../styles/chat.scss'\n\nexport default function ChatMessageView ({ message, sender, tags={} }) {\n  const messageClasses = [\n    'chat_message'\n  ]\n  let senderName = 'SENSI'\n\n  if(sender === SENDER_IS_PLAYER){\n    messageClasses.push('chat_message--own')\n    senderName = '<SPIELERNAME>'\n  } else {\n    messageClasses.push('chat_message--others')\n  }\n\n\n  const myRef = React.createRef();\n  let audio = ''\n  if('audio' in tags){\n    console.log(\"has audio\")\n    audio = (\n      <audio ref={myRef} src={tags.audio} controls/>\n      )\n  }\n  let images = []\n  if( 'images' in tags ){\n    images = tags.images;\n  }\n  return (\n    <div className={messageClasses.join(' ')}>\n      <h5 className='chat_message__sender'>{senderName}</h5>\n      <div className='chat_message__message'>\n        <p>{message}</p>\n        {audio}\n        <ChatImageView images={images} />\n      </div>\n    </div>\n  )\n}\n\nChatMessageView.propTypes = {\n  message: PropTypes.string.isRequired,\n  sender: PropTypes.string.isRequired\n}\n","import { createSelector } from 'reselect'\n\nexport function selectChatMessages (state) {\n  return state.chat.messageQueue\n}\n\nexport function selectChatLastReadIndex (state) {\n  return state.chat.lastRead\n}\n\nexport function selectChatOptions (state) {\n  return state.chat.chatOptions\n}\n\nexport const getChatLastReadIndex = createSelector(\n  [selectChatLastReadIndex],\n  index => index,\n)\nexport const getUnreadMessageCount = createSelector(\n  [selectChatLastReadIndex, selectChatMessages],\n  (lastIndex, messages)=> messages.length - (lastIndex + 1),\n)\n\nexport const getChatMessages = createSelector(\n  [selectChatMessages],\n  (messages) => messages\n)\n\nexport const getChatOptions = createSelector(\n  [selectChatOptions],\n  (options) => options\n)\n","import { connect } from 'react-redux'\n\nimport ChatButtonView from '../components/ChatButton.view.js'\nimport ChatView from '../components/Chat.view.js'\nimport ChatTool from '../components/chatToolbar.component.js'\n\nimport { \n  chooseChatOption,\n  markMessageRead\n} from '../actions/chat.actions.js'\n\nimport { \n  getChatMessages,\n  getChatOptions,\n  getChatLastReadIndex,\n  getUnreadMessageCount\n} from '../selectors/chat.selector.js'\n\nconst mapStateToProps = state => {\n  return {\n    messages: getChatMessages(state),\n    chatOptions: getChatOptions(state),\n    lastReadIndex: getChatLastReadIndex(state)\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    markMessagesRead: (i) => dispatch(markMessageRead(i))\n  }\n}\n\nconst Chat = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ChatView)\n\nexport default Chat\n\nfunction mapStateToToolbarProps (state) {\n  return {\n    chatOptions: getChatOptions(state)\n  }\n}\n\nconst mapDispatchToToolbarProps = dispatch => {\n  return {\n    onSendMessage: (option) => dispatch(chooseChatOption(option))\n  }\n}\n\nexport const ChatToolbar = connect(\n  mapStateToToolbarProps,\n  mapDispatchToToolbarProps,\n)(ChatTool)\n\nfunction mapStateToButtonProps (state) {\n  return {\n    unreadMessageCount: getUnreadMessageCount(state)\n  }\n}\n\nconst mapDispatchToButtonProps = dispatch => {\n  return {\n  }\n}\n\nexport const ChatButton = connect(\n  mapStateToButtonProps,\n  mapDispatchToButtonProps,\n)(ChatButtonView)\n\n","import React, {useEffect, useRef} from 'react'\nimport PropTypes from 'prop-types'\nimport ChatMessageView from './ChatMessage.view.js'\n\nimport '../styles/chat.scss'\n\nexport default function ChatView ({messages, chatOptions, lastReadIndex, markMessagesRead}) {\n\n  const messagesEndRef = useRef(null)\n\n  const scrollToLastRead = () => {\n    if(messagesEndRef.current.children.length > 0){\n    messagesEndRef.current.children[lastReadIndex].scrollIntoView({ block: 'end', behavior: \"smooth\" })\n    }\n    if(lastReadIndex < (messages.length - 1)) {\n      markMessagesRead(messages.length - 1)\n    }\n  }\n\n  useEffect(scrollToLastRead, [messages, chatOptions]);\n\n  return (\n    <div className=\"chat\">\n      <section ref={messagesEndRef} className=\"message_board\">\n        { messages.map((m, idx) => <ChatMessageView key={idx} {...m} />)}\n      </section>\n    </div>\n  )\n}\n\nChatView.propTypes = {\n  messages: PropTypes.arrayOf(\n    PropTypes.shape({\n      message: PropTypes.string,\n      sender: PropTypes.string\n    })\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default function ChatToolbar({ onSendMessage, chatOptions }) {\n  const chooseFrom = chatOptions.map(option => {\n    return (\n      <button\n        key={option.index} \n        className='chat_toolbar__option'\n        onClick={() => onSendMessage(option.index)}\n      >{option.text}</button>)\n  })\n  return (\n    <div className='toolbar chat_toolbar'>\n      {chooseFrom}\n    </div>\n  )\n}\n\nChatToolbar.propTypes = {\n  onSendMessage: PropTypes.func,\n  chatOptions: PropTypes.arrayOf(\n    PropTypes.shape({\n      text: PropTypes.string,\n      index: PropTypes.number\n    })\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport { Link } from 'react-router-dom'\n\nexport default function ChatButtonView ({ unreadMessageCount }) {\n\n  const classes = ['header__button', 'header__button_chat']\n  let text = <span>Chat</span>\n  if(unreadMessageCount > 0){\n    classes.push('header__button_chat--unread')\n    text = <span> Chat <span class=\"header__button_chat__count\">{unreadMessageCount}</span> Ungelesene Nachrichten </span>\n  }\n\n  return (\n    <Link to=\"/chat\" className={classes.join(' ')}>{text}</Link>\n  )\n}\n\nChatButtonView.propTypes = {\n  unreadMessageCount: PropTypes.number\n}\n","import React from 'react';\nimport { Route, Switch } from 'react-router'\nimport { ChatToolbar } from '../containers/chat.container.js'\n\nexport default function ToolbarComponent () {\n  return (\n    <Switch>\n      <Route path='/chat' component={ChatToolbar} />\n      <Route>\n        <div className=\"empty-toolbar\"/>\n      </Route>\n    </Switch>\n  )\n}\n","import { createSelector } from 'reselect'\n\nexport function selectCurrentLocation(state) {\n  return state.geolocation.currentLocation\n}\n\n/**\n * @param {State} state\n * @return string?\n */\nexport const getCurrentLatitude = createSelector(\n  [selectCurrentLocation],\n  (currentLocation) => currentLocation.latitude )\n\n/**\n * @param {State} state\n * @return string?\n */\nexport const getCurrentLongitude = createSelector(\n  [selectCurrentLocation],\n  (currentLocation) => currentLocation.longitude )\n\n/**\n * @param {State} state\n * @return string[]\n */\nexport const getCurrentPosition = createSelector(\n  [selectCurrentLocation],\n  (currentLocation) => {\n    return {\n      lat: currentLocation.latitude,\n      long: currentLocation.longitude \n    }\n  }\n)\n\n","import { createSelector } from 'reselect'\n\nexport function selectStations(state) {\n    console.log(state.resources.stations)\n  try{\n    return Object.values(state.resources.stations)\n  } catch {\n    return []\n  } \n}\n\n/**\n * @param {State} state\n * @return Object[]?\n */\nexport const getStations = createSelector(\n  [selectStations],\n  (stations) => stations )\n","import { connect } from 'react-redux'\n\nimport DevView from '../components/dev.view.js'\n\nimport {getCurrentPosition} from '../selectors/geo.selector.js'\nimport {getStations} from '../selectors/dev.selector.js'\n\nconst mapStateToProps = state => {\n  return {\n    position: getCurrentPosition(state),\n    stations: getStations(state),\n    state: JSON.stringify(state, null, '  ')\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n  }\n}\n\nconst Dev = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(DevView)\n\nexport default Dev\n","\nimport React from 'react'\n\nimport '../styles/dev.scss'\n\nexport default function DevView ({position, stations, state}) {\n  console.log(state)\n  return (\n    <div className=\"dev\">\n      <div className=\"position\">\n        <div className=\"dev__label\">Position</div>\n        <div className=\"dev__data\">{position.lat} , {position.long}</div>\n      </div>\n      <div className=\"dev--stations\">\n        <div className=\"dev__label\">Stations</div>\n        <div className=\"dev__data\">\n          {stations.map(s => {\n            return (\n              <div className=\"station\">\n              <strong>{s.station}:</strong> {s.latitude}, {s.longitude}\n              </div>)\n          }) }\n        </div>\n      </div>\n\n      <div className=\"state\">\n        <div className=\"dev__label\">State Data</div>\n        <div className=\"dev__data\">\n          <pre>\n            {state}\n          </pre>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport {\n  MESSAGE_TYPE_ERROR,\n  MESSAGE_TYPE_LOG,\n  MESSAGE_TYPE_SUCCESS,\n} from '../constants/messages.constatns.js'\n\nimport '../styles/messages.scss'\n\nexport default function MessageDisplay ({ messages, onMessageRead }) {\n  return (\n    <div className='message_display'>\n      {messages.map((m, idx) => (\n        <div\n          key={m.uuid}\n          className={['card', 'message', messageTypeCss[m.messageType]].join(' ')}\n          onClick={() => onMessageRead(m.uuid)}\n        >{m.text}</div>\n      ))}\n    </div>\n  )\n}\n\nMessageDisplay.propTypes = {\n  message: PropTypes.arrayOf(\n    PropTypes.shape({\n      messageType: PropTypes.string,\n      text: PropTypes.string\n    })\n  ),\n  onMessageRead: PropTypes.func\n}\n\nconst messageTypeCss = {\n  [MESSAGE_TYPE_ERROR]: 'message--error',\n  [MESSAGE_TYPE_LOG]: 'message--log',\n  [MESSAGE_TYPE_SUCCESS]: 'message--success'\n}\n","import { createSelector } from 'reselect'\nimport {\n  LAST_MESSAGE_COUNT,\n  MESSAGE_TIME_IN_SECONDS\n} from '../constants/messages.constatns.js'\n\nexport function selectMessages (state) {\n  return Object.values(state.messages.byUuid)\n}\n\nexport const getNewestMessages = createSelector(\n  [selectMessages],\n  (messages) => messages\n    .filter(m => !m.hide && m.timestamp + MESSAGE_TIME_IN_SECONDS * 1000 >= Date.now())\n    .sort((a,b) => a - b)\n    .slice(-LAST_MESSAGE_COUNT)\n)\n \n  /*\nfunction sortByTimestamp(a, b) {\n  a.timestamp - b.timestamp;\n  //if (a is less than b by some ordering criterion) {\n  if(a,timestamp)\n    return -1;\n  }\n  if (a is greater than b by the ordering criterion) {\n    return 1;\n  }\n  // a must be equal to b\n  return 0;\n}*/\n","import { connect } from 'react-redux'\n\nimport MessageDisplay from '../components/messageDisplay.js'\n\nimport { getNewestMessages } from '../selectors/message.selector.js'\n\nimport { hideMessage } from '../actions/messages.actions.js'\n\nconst mapStateToProps = state => {\n  return {\n    messages: getNewestMessages(state)\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onMessageRead: (uuid) => dispatch(hideMessage(uuid))\n  }\n}\n\nconst Messages = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(MessageDisplay)\n\nexport default Messages\n","/**\n * @param {double} latitude\n * @param {double} longitude\n * @return Boolean\n */\nexport function checkBounds(latitude, longitude) {\n  return (\n    latitude  >= mapBounds.latitude.min  &&\n    latitude  <= mapBounds.latitude.max  &&\n    longitude >= mapBounds.longitude.min &&\n    longitude <= mapBounds.longitude.max \n  )\n}\n\nexport const mapBounds = {\n  latitude: {\n    min: 50.82113813164011,\n    max: 50.85731159369495,\n  },\n  longitude: {\n    min:8.630602108424023,\n    max:8.701868299964586\n  }\n}\n","import React, {useEffect, useRef} from 'react'\nimport PropTypes from 'prop-types'\n\nimport { checkBounds } from '../utils/geo/checkBounds.js'\n\n\nexport default function Map (props) {\n  const iFrame = useRef(null)\n\n  // Similar to componentDidMount and componentDidUpdate:  \n  useEffect(() => {    \n    function onLoad () {\n          console.log(\"iframe loaded\")\n          iFrame.current.loaded = true;\n          interactWithIframe(iFrame, props);\n    }\n\n    if(iFrame.current.loaded){\n      interactWithIframe(iFrame, props);\n    } else {\n      iFrame.current.addEventListener('load', onLoad)\n    }\n  });\n  return (\n    <div>\n      <iframe \n        ref={iFrame}\n        id=\"mapIframe\"\n        title=\"Map Iframe\"\n        width=\"1000\"\n        height=\"1000\"\n        src=\"./assets/map/index.html\">\n      </iframe>\n    </div>\n  )\n}\n\nMap.propTypes = {\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n}\n\nfunction interactWithIframe(iFrame, props) {\n\n  const {latitude, longitude} = props\n\n  if(checkBounds(latitude, longitude)) {\n    if('setPositionMarker' in iFrame.current.contentWindow) {\n      console.log(\"SET POSITION\")\n      iFrame.current.contentWindow.setPositionMarker(latitude, longitude)\n\n    }\n  }   \n}\n","import { connect } from 'react-redux'\n\nimport MapView from '../components/mapIframe.view.js'\n\nimport {\n  getCurrentLatitude,\n  getCurrentLongitude\n} from '../selectors/geo.selector.js'\n\nconst mapStateToProps = state => {\n  return {\n    latitude: getCurrentLatitude(state),\n    longitude: getCurrentLongitude(state)\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n  }\n}\n\nconst Map = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(MapView)\n\nexport default Map\n","import React from 'react'\nimport { Route, Switch } from 'react-router'\nimport { Link } from 'react-router-dom'\nimport NoMatch from './noMatch.js'\nimport ToolbarComponent from '../components/toolbar.component.js'\nimport Chat, { ChatButton } from '../containers/chat.container.js'\nimport Dev from '../containers/dev.container.js'\n\nimport Messages from '../containers/messages.container.js'\n\nimport Map from '../containers/map.container.js'\n\nimport '../styles/app.scss'\nimport '../styles/header.scss'\n\nfunction dummyFrontPage (clearButton) {\n  function test () {\n      const routes = [\n        '/assets/images/Saftfluss.jpg',\n        '/assets/images/TreeTalker.jpg'\n      ]\n    window.navigator.serviceWorker.controller.postMessage({\n      type: 'NATURE40_ADD_ROUTE',\n      routes\n    })\n    Promise.all(routes.map(r => fetch(r)))\n  }\n  return (\n    <div className='dummy_front_page'>\n      <Link to='/chat'>GOTO Chat</Link>\n      <Link to='/map'>GOTO Map</Link>\n      <Link to='/dev'>Dev</Link>\n      <button onClick={test}> Test: Precache Saftfluss.jpg </button>\n      {clearButton || ''}\n    </div>\n  )\n}\n\nfunction App ({ clearButton }) {\n  return (\n    <div className='App'>\n      <header className='App-header'>\n        <Link to='/'>SENSO-Trail App</Link>\n        <nav className=\"nav\">\n          <Link to='/map' className=\"header__button header__button_map\">Map</Link>\n          <ChatButton />\n        </nav>\n        <Messages />\n      </header>\n      <main>\n        <Switch>\n          <Route exact path='/' render={() => dummyFrontPage(clearButton)} />\n          <Route exact path='/chat' component={Chat} />\n          <Route exact path='/map' component={Map} />\n          <Route exact path='/dev' component={Dev} />\n          <Route component={NoMatch} />\n        </Switch>\n      </main>\n      <ToolbarComponent />\n    </div>\n  )\n}\n\nexport default App\n","import { changeLocation, locationError } from '../../actions/geolocation.actions.js'\n\nfunction isAvailable(){\n  console.log('Geolocation available:', 'geolocation' in window.navigator)\n  return 'geolocation' in window.navigator\n}\n\nlet watcher = undefined\n\nfunction init(dispatch){\n  if(watcher){\n    console.error('A watcher is already defined')\n  }\n\n  function onLocationChanged(geolocationPosition) {\n    console.log('onLocationChanged:')\n    dispatch(changeLocation(\n      geolocationPosition.coords.latitude,\n      geolocationPosition.coords.longitude,\n    ))\n  }\n\n  function onLocationError(error) {\n    dispatch(locationError(error))\n    clear()\n  }\n  if(isAvailable()){\n    watcher = navigator.geolocation.watchPosition(onLocationChanged, onLocationError)\n  }\n}\n\n\nfunction clear(){\n  navigator.geolocation.clearWatch(watcher)\n  watcher = undefined\n}\n\nexport default {\n  init,\n  clear,\n  isAvailable\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\nconst defaultSuccess = () => console.log('registered')\nexport function register(config, success = defaultSuccess ) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n          success()\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config).then(success);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  return navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n"," // eslint-disable-next-line \nimport _POLYFILL from './utils/polyfills/index.js'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport { init as initConfig } from './utils/config.js';\n\nimport { Provider } from 'react-redux'\nimport { ConnectedRouter } from 'connected-react-router'\nimport { PersistGate } from 'redux-persist/integration/react'\n\nimport configureStore, { history } from './createStore.js'\nimport './styles/index.scss'\nimport App from './components/app.js'\n\nimport GeolocationEmitter from './utils/geo/geolocationEmitter.js'\n\nimport getNotificationPermission from './utils/notification/getPermission.js'\n\nimport * as serviceWorker from './serviceWorker'\n\n// For now only. Needs to be some sort of init action later\nimport { loadInkJsonStart } from './actions/chat.actions.js'\nimport { setSwActive } from './actions/resources.actions.js'\nimport { setNotificationPermission } from './actions/notification.actions.js'\n// import { loadResource } from './actions/resources.actions.js'\n\nconst { store, persistor } = configureStore()\n\nconst config = initConfig(process.env.PUBLIC_URL);\n\nfunction clearCaches () {\n  console.log('START CLEARING')\n  Promise.all([\n    window.caches.keys()\n      .then((names) => {\n        for (const name of names) {\n          window.caches.delete(name)\n        }\n      })\n      .then(() => { console.log('Service Worker cleared') }),\n    persistor.purge().then(() => {\n      console.log('Persist store cleared')\n    })\n  ]).then(() => {\n    console.log('all caches cleared')\n    window.location.reload()\n  })\n}\n\n\nGeolocationEmitter.init(store.dispatch)\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nif (process.env && process.env.NODE_ENV === 'production') {\n  const clearCachesButton = (\n    <button onClick={clearCaches}>Clear Caches</button>\n  )\n  ReactDOM.render(\n    <Provider store={store}>\n      <ConnectedRouter history={history} basename={process.env.PUBLIC_URL}>\n        <PersistGate loading={null} persistor={persistor}>\n          <App clearButton={clearCachesButton} />\n        </PersistGate>\n      </ConnectedRouter>\n    </Provider>\n    , document.getElementById('root'))\n  console.log('prod env')\n  serviceWorker.register({},() => {\n    store.dispatch(setSwActive())\n    store.dispatch(loadInkJsonStart(`${config.sources.trail}${config.trailname}.json`))\n  })\n\n} else {\n  ReactDOM.render(\n    <Provider store={store}>\n      <ConnectedRouter history={history} basename={process.env.PUBLIC_URL}>\n        <App />\n      </ConnectedRouter>\n    </Provider>\n    , document.getElementById('root'))\n  serviceWorker.unregister()\n\n  getNotificationPermission().then((notificationAllowed) => {\n    store.dispatch(setNotificationPermission(notificationAllowed))\n    store.dispatch(loadInkJsonStart(`${config.sources.trail}${config.trailname}.json`))\n  })\n}\n"],"sourceRoot":""}